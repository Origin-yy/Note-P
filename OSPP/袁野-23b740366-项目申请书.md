#                                                                                             Project Application



| Project Name:              | Mogan Draw on WASM           |
| -------------------------- | ---------------------------- |
| Project Mentor:            | Shen Da                      |
| Applicant:                 | Yuan Ye                      |
| Date:                      | June 3, 2023                 |
| Applicant Email:           | origin020726@gmail.com       |
| Applicant GitHub Homepage: | https://github.com/Origin-yy |

## 1 Project Background

### 1.1 Project Introduction

Mogan (Mogan Editor) is a structured editor under the Xmacs Labs. Mogan Editor is developed based on TeXmacs, aiming to popularize GNU TeXmacs and let everyone enjoy the fun of exploring science and technology through the software created by Joris van der Hoeven.

### 1.2 Project Related Repositories

Mogan does not want to be confined to a single platform. The project is maintained on almost all platforms and can submit tickets.

The main platforms are as follows:

- GitHub: https://github.com/XmacsLabs/mogan
- Gitee: https://gitee.com/XmacsLabs/mogan
- Codeberg: https://codeberg.org/XmacsLabs

## 2 Project Requirements Analysis

Xmacs Labs plans to promote Mogan Editor to middle school classrooms. In this summer of open source activity, I mainly add some drawing functions to Mogan Editor and make some improvements and optimizations in this direction, so that it can better serve the classroom.

"Imagine you are a high school teacher teaching Euclidean geometry and preparing slides with Mogan Editor/GNU TeXmacs."

### 2.1 User Interface Redesign:

Mathcha's graphics are generated by moving and scaling fixed graphic templates. Mogan starts from points and lines, and creates desired graphics through manual drawing. Based on this feature, Mogan can obtain finer control over geometric elements, but also brings complexity to the operation.

Currently, we mainly go through the process of "selecting toolbars -> selecting geometric elements -> operating -> selecting other functions in toolbars" to draw graphics, which is quite tedious. In addition, the "right-click" function is underdeveloped, and "right-click to expand menu" is a common impression. According to this, we can make the following designs:

1. Separate the selection function. The mouse style is an arrow, as the default state. Users can select one or a group of geometric elements by left-clicking or dragging a box with the left mouse button. Then the selected elements can be operated as follows:

   - When left-clicking:

     Display a rectangular frame similar to the Mathcha below (the frame has eight points that can be dragged to scale) and a point representing rotation. Users can move, scale, and rotate the selected geometric elements here.

     <img src="/home/origin/.config/Typora/typora-user-images/image-20230604104123244.png" alt="image-20230604104123244" style="zoom:50%;" />

   - When right-clicking:

     Display a menu similar to the Mathcha above, including more control and editing operations on the selected geometric elements, such as: grouping/separating, deleting, adding/deleting names, displaying coordinates, displaying angles, filling, etc.

2. Reduce the toolbars and menus above, retain some functions, and integrate some functions into the right-click, complementing each other with overlapping and unique functions:

   - When the mouse is in the selection function, right-click in the blank area to display the menu, including some functions in the toolbar, such as: adding geometric elements, setting grids, inserting text, etc.

### 2.2 New Features and Bug Fixes

1. **Add the function of drawing a circle with two points**

   After selecting this function, the first point clicked by the mouse determines the center of the circle, and the second point determines the radius. When drawing, you can choose whether to show the center of the circle.

2. **Add the function of drawing an ellipse**

   After selecting this function, the first two points clicked by the mouse determine the two foci, and the third point is a point on the ellipse. When drawing, you can choose whether to show the two foci.

3. **Draw sectors/arcs**

   After selecting this function, the first point clicked by the mouse is the center of the circle, and the next two points are the two radii. When the central angle is 90 or 180 degrees, there will be a snap.

4. **Implement various arrows and decorations**

   Provide more style options in the drop-down menus of arrows and arrow bodies, at least supporting all the arrow and arrow body styles in quiver, replacing the default arrow styles in TeXmacs (not beautiful enough), to be consistent with quiver.

5. **Display angles**

   If the user selects an intersection point of two or more line segments, when right-clicking to expand the menu, you can select to add an angle for a vertex of this point, marked with a small arc, with a right angle mark for right angles. The menu can also choose: delete angle mark, add/delete the name/angle of the corner, change the name of the corner, etc. (the angle mark, name and corner are integrated).

6. **Add the function to identify element names**

   If the user selects a geometric element (corner, point, line, shape), etc., you can select to add/delete the name in the expanded menu when right-clicking. You can also change the identified element name and the identified position. The identification and element are integrated.

7. **Add coordinate display function**

   If the user selects a point, you can select the "display coordinates" function in the expanded menu when right-clicking. The coordinates and the point are integrated. You can drag to change the display position of the coordinates. You can also manually enter coordinates to modify the position of the point.

### 2.3 Mogan Draw: WASM Application

With the help of the community, host Mogan Draw at [https://draw.mogan.app](https://draw.mogan.app/) to make it a standalone drawing application as small as possible.

### 2.3 Produce Related Documentation and Tutorial Videos

Re-draw some graphics in Publicity: Euclid's Element using Mogan Draw and produce video tutorials showing the detailed steps of drawing graphics, and then upload them to Bilibili or YouTube.

## 3 Technical Methods and Feasibility Analysis

| Related code files                         | Function                                                     |
| ------------------------------------------ | ------------------------------------------------------------ |
| `src/Graphics/Renderer/printer`            | Contains the printing function of the renderer.              |
| `src/Typeset/Concat/concat_graphics`       | Contains some typesetting graphics functions, such as `typeset_arc()`. |
| `src/Plugins/Qt/qt_renderer`               | Qt's drawing interface.                                      |
| `TeXmacs/progs/graphics/graphics-menu.scm` | The menu display of the toolbar.                             |
| `src/Data/Drd/drd_std`                     | Performs the operations of the functions selected by the user. |

| Data structure                  | Function                                                     |
| ------------------------------- | ------------------------------------------------------------ |
| `class tree`                    | The core structure, its leaf nodes represent different types of elements to be displayed, such as curves, points, lines, strings, etc., labeled with `t.rep->op`. |
| `struct graphics_box_rep`       | The graphics box class, which contains methods for selecting graphic elements based on mouse position or rectangular area. |
| `struct graphics_group_box_rep` | The graphics group box class, which contains methods for selecting the entire graphics group. |
| `struct curve_box_rep`          | The curve box class. It contains curve objects, brushes, etc., and methods for drawing curves. |
| `class curve`                   | The class representing a curve, which is represented by a `curve_rep` pointer to a curve, and a curve is drawn according to a set of points and paths. |

| Function/method                              | Function                                                     |
| -------------------------------------------- | ------------------------------------------------------------ |
| `void init_std_drd ()`                       | According to the element type created by the user's selection, it initializes a subtree of `tree t` with different labels and starts the creation process. |
| `concater_rep::typeset (tree t, path ip)`    | This function is called repeatedly, passing in a subtree of `tree t` with different labels and the current tree path, executing the element creation process, and entering the corresponding function according to the label. When the conditions required for adding the element type are met, it stops calling and adds the subtree to the original tree. |
| `void curve_box_rep::display (renderer ren)` | The drawing method of the curve.                             |

## 4. Project product design

Our product mainly serves the geometry teaching in middle school. For geometry teaching in middle school classrooms, it mainly involves the following contents:

1. Basic geometric elements drawing: points, line segments, lines, rays, angles, quadrilaterals, circles, triangles.
2. Geometric figure related calculations: angle calculation, line segment length calculation, figure area calculation.
3. Geometric relationship proof: angle equality, line segment parallelism, area equality.

For a middle school teacher who teaches Euclidean geometry courses, the convenience of drawing figures and the control and depiction of geometric figures are most important. Therefore, we can focus on the following points:

1. Simple and easy to use:

   You can operate directly on the web page, reducing the difficulty and cost of learning.

2. More convenient operation mode:

   Reduce dependence on toolbars and increase mouse right-click functionality.

3. Control of geometric figures:

   Move, select, rotate graphic elements and combine graphic elements.

4. Depiction of geometric elements:

   Angle marking, area representation, length representation, graphic element name representation and graphic element information representation.

Our main functions focus on figure drawing and information display to meet the needs of middle school geometry classroom teaching and teacher use.

## 5. Timeline

| Week |              Dates              | Work                                                         |
| ---- | :-----------------------------: | :----------------------------------------------------------- |
| 0    |          Before July 1          | Continue to familiarize yourself with the project, read code, communicate with mentors, deepen your understanding of project-related code knowledge and learn scheme language. Design detailed interface optimization plan and try some ideas of your own. |
| 1    |       July 1st ~ July 7th       | With the help of the community host Mogan Draw on [https://draw.mogan.app](https://draw.mogan.app/) , making it as small as possible an independent drawing application. |
| 2    |      July 8th ~ July 14th       | Optimize user interface and test compatibility and stability. |
| 3    |      July 15th ~ July 21th      | Add code for drawing circles with two points and test to ensure it works properly. |
| 4    |      July 22th ~ July 28th      | Add code for drawing ellipses and test to ensure it works properly. |
| 5    |     July 29th ~ August 4th      | Add code for drawing sectors/arcs and test to ensure it works properly. |
| 6    |    August 5th ~ August 11th     | Implement various arrow and decoration functions and test to ensure they work properly. |
| 7    |    August 12th ~ August 18th    | Add code for displaying angles and test to ensure it works properly. |
| 8    |    August 19th ~ August 25th    | Add code for identifying element names and test to ensure it works properly. |
| 9    |   August 26th ~ September 1st   | Add coordinate display function code and test to ensure it works properly. |
| 10   |  September 2nd ~ September 8th  | Some bug fixes and optimizations for existing bugs.          |
| 11   | September 9th ~ September 15th  | Write relevant design documents and function introduction documents |
| 12   | September 16th ~ September 22th | Use Mogan Draw to redraw some figures in Publicity: Euclid’s Element and make a video showing the detailed steps of drawing figures, then upload it to Bilibili or YouTube |

#### Buffer Time (8 days)

Allow for a buffer period of 8 days as a safety net, in case anything does not go as planned.

## 6. Expectations

Through the OSPP, I can participate in the development of open source projects. In the project, I can learn technology, improve my coding level, broaden my horizons, and gain experience in large-scale project development.