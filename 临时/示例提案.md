项目申请书


项目名称        Mogan Draw
项目主导师       沈达
申请人         谢博谦
日期          2023年5月26日
申请人邮箱       shiftregister233@outlook.com
申请人GitHub主页 https://github.com/pokyux

1  项目背景 

1.1  项目简介 

Mogan（墨干编辑器）是墨客实验室旗下的结构化编辑器。墨干编辑器在TeXmacs的基础上进行开发，旨在普及GNU TeXmacs，让所有人都能够通过Joris van der Hoeven创造的软件享受探索科学与技术的乐趣。
1.2  项目相关仓库 

Mogan并不想拘束于单一平台，该项目在几乎所有平台都有维护，可以提交工单。
主要的平台如下：
•  GitHub: https://github.com/XmacsLabs/mogan
•  Gitee: https://gitee.com/XmacsLabs/mogan
2  项目需求分析 

墨客实验室计划将墨干编辑器推广至中学课堂。本次开源之夏活动，我主要为墨干编辑器添加一些绘图方面的功能，并在此方向上进行一些改进和优化，使之能更好地为课堂服务。
「想象你是一名讲授欧几里德图形的高中教师，正准备用墨干编辑器/GNU TeXmacs准备幻灯片。」
目前，我打算为Mogan添加以下几个功能：
1.为Mogan添加2步画圆的功能
目前Mogan使用三个点确定一个圆，但实际上我们通过两个点就可以确定唯一一个圆（第一个点确定圆心，第二个确定半径）。后者无论是在论文编写，还是在课堂教学中，都要优于前者，故我希望能为Mogan实现这个功能。
画圆功能需要支持两种圆：带圆心与不带圆心。
2.增加绘制椭圆的功能
当前Mogan还不支持画椭圆，但是在中学，尤其是高中的教学中，画椭圆是一个常见的需求。
Mogan Draw项目的椭圆与圆差不多，绘制时可以选择是否：标注圆心、长轴与短轴。
3.绘制扇形
特别地，当扇形角度在180度附近时，提供一个自动吸附，使其成为一个标准半圆；在90度附近时，也会自动吸附，并在圆心处标记直角。
4.支持尺规作图
即绘制一小段圆弧，并标示其圆心所在处。还可以选择是否将圆心与圆弧以实线或者虚线连接。
5.支持绘制带有角度标记的折线
绘制折线时，可以选择在折线转向处标记角度。若角度为90度，则绘制直角标记。
6.识别垂足，并自动添加直角记号
7.在绘图工具中，添加框选功能
框选后，被选中的图形会被特殊标记。光标悬浮其上时，会显示成“小手”，提示用户这些图形可以拖动。
8.增加“油漆桶”功能
可以识别一个封闭区域，并为其中填入特定颜色。此功能可以方便一些题目和情形的描述（比如：求阴影部分面积）。
9.合并点
将属于不同图形、线段的点合并，形成一个更大的完整图形。
10.滑动点
在涉及“滑动点”类型的演示场景中可能会有用。新的点如果吸附在旧线上，则可以沿着这条线滑动。
目前的设想：按住shift再拖动这个点，这个点就会沿着当前线条滑动。
11.绘制函数图像
将数学表达式转化为函数并绘制在坐标表格上。
这项功能可以描述一些数形结合的问题，配合”滑动点“的功能，可以满足很多中学教学场景的需求。
12.改进arrow-with-text功能，并优化箭头的渲染
目前，Mogan只支持一种样式的矢量绘制：在箭头居中处展示文字标记。
改进想法：其中的文字标签可以拖动至相对箭头本体的任何位置。
13.WASM 打包
将Mogan Draw部分的代码打包成WASM，支持其在浏览器内运行，与本地保持相似的使用体验。
3  技术方法及可行性分析 

为以上功能，需要完成以下几个比较大的子功能：
1.检测夹角，绘制角标
2.检测直角，绘制垂直标记
3.在给定区间内，为给定的函数表达式生成点集，再进行绘制
4.为整个画布生成一个二维图像，配合广度优先算法，实现油漆桶功能
3.1  绘图工具的技术架构 

3.1.1  数据模型 

Scheme基础知识 
(point "0" "0")
(line (point "0" "0") (point "0" "0"))
Scheme]  '(1 2 3)

(1 2 3)
Scheme]  ‘(1 2 3 4 ,(+ 5 6))

(1 2 3 4 11)
Scheme]  (define (is-point? p)
  (and (pair? p)
       (in? (car p) '(point))
       (pair? (cdr p))
       (npair? (cadr p))))

is-point?
Scheme]  (is-point? ‘(tuple "0" "0"))

#f
Scheme]  (define p '(point "0" "0"))

(point "0" "0")
Scheme]  (cdr p)

("0" "0")
Scheme]  (car (cdr p))

"0"
Scheme]  

JSON -> JSONNET
linepoint"0""0"point"1""1"
quosiquoate concept in Scheme
Python tuple
stree and tree 
(define (plot l) (stree->tree l))
stree. Scheme Tree
tree. tree defined by C++ in tree.cpp
(document (TeXmacs "2.1.2") (style (tuple "generic" "chinese"))
          (body (document (point "1" "1"))) (initial (collection (associate "page-medium" "paper"))))
(with "gr-mode" "point" "gr-frame" 
      (tuple "scale" "1cm" (tuple "0.5gw" "0.470003gh"))
      "gr-geometry"                    
      (tuple "geometry" "1par" "0.6par")
      "gr-grid"
      (tuple "empty")
                           "gr-edit-grid-aspect"
      (tuple (tuple "axes" "none")
                                  (tuple "1" "none") (tuple "10" "none"))
                           "gr-edit-grid"
      (tuple "empty")
      "gr-grid-old"
      (tuple "cartesian" (point "0" "0") "1")
      "gr-edit-grid-old"
      (tuple "cartesian" (point "0" "0") "1")
      (graphics "" (point "0" "0") (point "1" "1")))

Scheme]  (define (plot l) (stree->tree l))

Scheme]  (define (points_n n) 
  (if (== n 1)
      '(point 1 1)
      ‘((point ,n ,n) (point ,(- n 1) ,(- n 1)))))

points_n
Scheme]  (cons (points 3 3) (points_n 2))

unbound variable points in (points 3 3)
Scheme]  (plot ‘(tuple "1" "1"))

11
Scheme]  (plot ‘(graphics (line (point "1" "1") (point "0" "0")) (point "1" "1") (point "0" "0")))


Scheme]  

3.2  Where is code 

•  src/Graphics
∘  Colors
∘  Types
•  src/Typeset
∘  Boxes
-  Graphics
•  src/Edit/Interface
∘  edit_graphics.cpp
∘  edit_graphic.hpp
•  src/Plugins/Qt
∘  Mouse
•  TeXmacs/progs/graphics
4  项目产品设计 

5  时间规划 

本申请根据“周”为时间节点进行规划。具体的规划如表格1所示。
表格 1. 具体时间安排


时间  描述              备注
第1周 圆与椭圆的绘制、WASM打包  
第2周 绘制椭圆、尺规作图       
第3周 角度标记、垂足的识别      
第4周 框选图形、油漆桶        
第5周 合并点、滑动点         
第6周 绘制函数图像、实现箭头相关功能 
第7周 修复Bug、为以上工作收尾   


6  期望 

进入研究生阶段后，我打算使用Mogan进行论文的写作。希望借助这个机会参与到Mogan项目中，更好地了解这个软件，并结合自己的实际使用体验来继续为墨客实验室社区贡献。
此外，Mogan所使用的C/C++语言也和我研究生方向相同。因此我也希望能在Mogan的开发实践中，提升我的编程能力，尤其是内存管理能力，写出更高质量的C/C++代码。